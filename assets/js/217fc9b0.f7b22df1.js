"use strict";(globalThis.webpackChunkbeacon_docs=globalThis.webpackChunkbeacon_docs||[]).push([[6385],{47758:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>h,default:()=>g,frontMatter:()=>l,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"wallet/getting-started/ios/connect-to-dapp","title":"Connect to a dApp","description":"Requirements","source":"@site/docs/wallet/getting-started/ios/connect-to-dapp.mdx","sourceDirName":"wallet/getting-started/ios","slug":"/wallet/getting-started/ios/connect-to-dapp","permalink":"/wallet/getting-started/ios/connect-to-dapp","draft":false,"unlisted":false,"editUrl":"https://github.com/airgap-it/beacon-docs/edit/main/src/docs/wallet/getting-started/ios/connect-to-dapp.mdx","tags":[],"version":"current","frontMatter":{"title":"Connect to a dApp"},"sidebar":"wallet","previous":{"title":"Installation","permalink":"/wallet/getting-started/ios/installation"},"next":{"title":"Disconnect from a dApp","permalink":"/wallet/getting-started/ios/disconnect-from-dapp"}}');var r=t(74848),o=t(28453),a=t(11470),c=t(19365),i=t(14252);const l={title:"Connect to a dApp"},h=void 0,d={},u=[{value:"Requirements",id:"requirements",level:2},{value:"How to listen for messages and respond",id:"how-to-listen-for-messages-and-respond",level:2},{value:"Create a wallet client",id:"create-a-wallet-client",level:3},{value:"Subscribe to incoming requests",id:"subscribe-to-incoming-requests",level:3},{value:"Connect to a dApp",id:"connect-to-a-dapp",level:3},{value:"Handle requests from the dApp",id:"handle-requests-from-the-dapp",level:3},{value:"Example Code",id:"example-code",level:2}];function p(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.A,{toc:u}),"\n",(0,r.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsx)(n.p,{children:"Make sure you have added the following packages as your dependencies:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"BeaconCore\nBeaconClientWallet\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You should have also decided which blockchains will be supported in your application and what transport layers to use to establish the communication. Make sure you have added the appropriate ",(0,r.jsx)(n.a,{href:"installation#blockchain",children:"Blockchain"})," and ",(0,r.jsx)(n.a,{href:"installation#transport",children:"Transport"})," packages as your dependencies as well."]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["See the ",(0,r.jsx)(n.a,{href:"installation",children:"Installation"})," page for more information about the packages and how to install them."]})}),"\n",(0,r.jsx)(n.h2,{id:"how-to-listen-for-messages-and-respond",children:"How to listen for messages and respond"}),"\n",(0,r.jsx)(n.p,{children:"Follow the steps below to learn how to interact with a dApp. The guide assumes all blockchains and transport layers are supported."}),"\n",(0,r.jsx)(n.h3,{id:"create-a-wallet-client",children:"Create a wallet client"}),"\n",(0,r.jsxs)(n.p,{children:["Create a ",(0,r.jsx)(n.code,{children:"Beacon.WalletClient"})," instance by providing your app's name, registering supported blockchains and transport layers that will be used for communication."]}),"\n",(0,r.jsxs)(n.p,{children:["The example below creates a new ",(0,r.jsx)(n.code,{children:"Beacon.WalletClient"})," instance with default settings. See the ",(0,r.jsx)(n.a,{href:"/wallet/advanced/ios/configuration",children:"Configuration"})," guide to learn about more advanced setups."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",children:'import BeaconCore\nimport BeaconBlockchainSubstrate\nimport BeaconBlockchainTezos\nimport BeaconClientWallet\nimport BeaconTransportP2PMatrix\n\n...\n\nvar beaconWallet: Beacon.WalletClient!\n\ndo {\n    // highlight-start\n    Beacon.WalletClient.create(\n        with: .init(\n            name: "MyApp",\n            blockchains: [Substrate.factory, Tezos.factory], // set support for Substrate and Tezos blockchains\n            connections: [try Transport.P2P.Matrix.connection()] // use Matrix to communicate with the Beacon network\n        )\n    ) { result in\n    // highlight-end\n        switch result {\n        case let .success(client):\n            beaconWallet = client\n        case let .failure(error):\n            print(error)\n        }\n    }\n} catch {\n    print(error)\n}\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["Currently only one instance of ",(0,r.jsx)(n.code,{children:"Beacon.WalletClient"})," should be created per application."]})}),"\n",(0,r.jsx)(n.h3,{id:"subscribe-to-incoming-requests",children:"Subscribe to incoming requests"}),"\n",(0,r.jsx)(n.p,{children:"Subscribe to requests from the dApp by connecting to the Beacon network and listening to incoming requests."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",children:"import BeaconCore\nimport BeaconBlockchainSubstrate\nimport BeaconBlockchainTezos\nimport BeaconClientWallet\n\n...\n\n// highlight-start\nbeaconWallet.connect { result in\n// highlight-end\n    switch result {\n    case .success(_):\n        // highlight-start\n        beaconWallet.listen(onRequest: onSubstrateRequest) // listen for Substrate requests\n        beaconWallet.listen(onRequest: onTezosRequest) // listen for Tezos requests\n        // highlight-end\n    case let .failure(error):\n        print(error)\n    }\n}\n\n...\n\nfunc onSubstrateRequest(_ request: Result<BeaconRequest<Substrate>, Beacon.Error>) {\n    // TODO: Not yet implemented\n}\n\nfunc onTezosRequest(_ request: Result<BeaconRequest<Tezos>, Beacon.Error>) {\n    // TODO: Not yet implemented\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"connect-to-a-dapp",children:"Connect to a dApp"}),"\n",(0,r.jsxs)(n.p,{children:["To connect to a new dApp take the pairing request (obtained from, for example, a paring QR code) and transform it to ",(0,r.jsx)(n.code,{children:"Beacon.P2PPeer"}),". Next, register the new instance of ",(0,r.jsx)(n.code,{children:"Beacon.P2PPeer"})," in your wallet client."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",children:'import BeaconCore\nimport BeaconClientWallet\n\n// highlight-start\n// replace placeholder values with data provided in the dApp\'s pairing request\nlet dApp = Beacon.P2PPeer(\n    id: "id",\n    name: "name",\n    publicKey: "publicKey",\n    relayServer: "relayServer",\n    version: "version"\n)\n// highlight-end\n\n// highlight-start\n// connect to a new peer\nbeaconWallet.add([.p2p(dApp)]) { result in\n// highlight-end\n    switch result {\n        case .success(_):\n            print("dApp connected")\n        case let .failure(error):\n            print(error)\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"handle-requests-from-the-dapp",children:"Handle requests from the dApp"}),"\n",(0,r.jsxs)(n.p,{children:["Having received a request, you can create a response and send it back to the dApp. The response should ",(0,r.jsx)(n.em,{children:"always"})," be created from an incoming request. Attempting to send a response that was not created from a request awaiting answer will result in an error."]}),"\n",(0,r.jsx)(n.p,{children:"The first request your app receives from a dApp is a permission request. The example below shows how to respond to it in the most basic way. To get more information about other kinds of requests or learn more advanced use cases see the Blockchain  guides."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",children:'import BeaconCore\nimport BeaconBlockchainSubstrate\nimport BeaconBlockchainTezos\nimport BeaconClientWallet\n\nfunc onSubstrateRequest(_ request: Result<BeaconRequest<Substrate>, Beacon.Error>) {\n    do {\n        let request = try request.get()\n        let response = try response(from: request)\n\n        // highlight-start\n        beaconWallet.respond(with: response) { result in\n        // highlight-end\n            switch result {\n            case .success(_):\n                print("Response sent")\n            case let .failure(error):\n                print(error)\n            }\n        }\n    } catch {\n        print(error)\n    }\n}\n\nfunc response(from request: BeaconRequest<Substrate>) throws -> BeaconResponse<Substrate> {\n    // highlight-start\n    switch request {\n    case let .permission(content):\n        let accounts = try content.networks.map { try substrateAccount(network: $0) }\n        return .permission(PermissionSubstrateResponse(from: content, accounts: accounts))\n    case let .blockchain(blockchain):\n        return .error(ErrorBeaconResponse(from: blockchain, errorType: .aborted))\n    }\n    // highlight-end\n}\n\nfunc onTezosRequest(_ request: Result<BeaconRequest<Tezos>, Beacon.Error>) {\n    do {\n        let request = try request.get()\n        let response = try response(from: request)\n\n        // highlight-start\n        beaconWallet.respond(with: response) { result in\n        // highlight-end\n            switch result {\n            case .success(_):\n                print("Response sent")\n            case let .failure(error):\n                print(error)\n            }\n        }\n    } catch {\n        print(error)\n    }\n}\n\nfunc response(from request: BeaconRequest<Tezos>) throws -> BeaconResponse<Tezos> {\n    // highlight-start\n    switch request {\n    case let .permission(content):\n        let account = try tezosAccount(network: content.network)\n        return .permission(PermissionTezosResponse(from: content, account: account))\n    case let .blockchain(blockchain):\n        return .error(ErrorBeaconResponse(from: blockchain, errorType: .aborted))\n    }\n    // highlight-end\n}\n\n// replace placeholder values with valid data\nfunc substrateAccount(network: Substrate.Network) throws -> Substrate.Account {\n    try Substrate.Account(\n        publicKey: "substratePublicKey",\n        address: "substrateAddress",\n        network: network\n    )\n}\n\nfunc tezosAccount(network: Tezos.Network) throws -> Tezos.Account {\n    try Tezos.Network(\n        publicKey: "tezosPublicKey",\n        address: "tezosAddress",\n        network: network\n    )\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"example-code",children:"Example Code"}),"\n",(0,r.jsxs)(n.p,{children:["The following example shows how to create a simple class which connects to a dApp using ",(0,r.jsx)(n.a,{href:"https://matrix.org/",children:"Matrix"})," and handles ",(0,r.jsx)(n.a,{href:"https://substrate.io/",children:"Substrate"})," and ",(0,r.jsx)(n.a,{href:"https://tezos.com/",children:"Tezos"})," messages based on the steps described earlier."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://github.com/airgap-it/beacon-ios-sdk",children:(0,r.jsx)(n.img,{src:"https://img.shields.io/github/v/tag/airgap-it/beacon-ios-sdk?label=stable&sort=semver",alt:"stable"})}),"\n",(0,r.jsx)(n.a,{href:"https://github.com/airgap-it/beacon-ios-sdk",children:(0,r.jsx)(n.img,{src:"https://img.shields.io/github/v/tag/airgap-it/beacon-ios-sdk?color=orange&include_prereleases&label=latest",alt:"latest"})})]}),"\n",(0,r.jsxs)(a.A,{groupId:"package-manager",defaultValue:"spm",values:[{label:"SPM",value:"spm"},{label:"CocoaPods",value:"cocoapods"}],children:[(0,r.jsxs)(c.A,{value:"spm",children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",metastring:'title="Package.swift"',children:'dependencies: [\n    .package(url: "https://github.com/airgap-it/beacon-ios-sdk", from: "x.y.z")\n],\n'})}),(0,r.jsxs)(n.p,{children:["Or in Xcode open the ",(0,r.jsx)(n.code,{children:"Add Package Dependency"})," window (as described in ",(0,r.jsx)(n.a,{href:"https://developer.apple.com/documentation/xcode/adding_package_dependencies_to_your_app",children:"the official guide"}),") and enter the ",(0,r.jsx)(n.code,{children:"Beacon iOS SDK"})," GitHub repository URL"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"https://github.com/airgap-it/beacon-ios-sdk\n"})})]}),(0,r.jsx)(c.A,{value:"cocoapods",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="Podfile"',children:"target 'MyTarget' do\n    use_frameworks!\n\n    pod 'BeaconCore', :git => 'https://github.com/airgap-it/beacon-ios-sdk', :tag => 'x.y.z'\n    pod 'BeaconClientWallet', :git => 'https://github.com/airgap-it/beacon-ios-sdk', :tag => 'x.y.z'\n    pod 'BeaconBlockchainSubstrate', :git => 'https://github.com/airgap-it/beacon-ios-sdk', :tag => 'x.y.z'\n    pod 'BeaconBlockchainTezos', :git => 'https://github.com/airgap-it/beacon-ios-sdk', :tag => 'x.y.z'\n    pod 'BeaconTransportP2PMatrix', :git => 'https://github.com/airgap-it/beacon-ios-sdk', :tag => 'x.y.z'\nend\n"})})})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",metastring:'title="BeaconExample.swift"',children:'import Foundation\nimport BeaconCore\nimport BeaconBlockchainSubstrate\nimport BeaconBlockchainTezos\nimport BeaconClientWallet\nimport BeaconTransportP2PMatrix\n\nclass BeaconExample {\n    var beaconWallet: Beacon.WalletClient!\n\n    let dApp = Beacon.P2PPeer(\n        id: "0b02d44c-de33-b5ab-7730-ff8e62f61869" /* TODO: change me */,,\n        name: "My dApp",\n        publicKey: "6c7870aa1e42477fd7c2baaf4763bd826971e470772f71a0a388c1763de3ea1e" /* TODO: change me */,\n        relayServer: "beacon-node-1.sky.papers.tech" /* TODO: change me */,\n        version: "2" /* TODO: change me */\n    )\n\n    func substrateAccount(network: Substrate.Network) throws -> Substrate.Account {\n        try Substrate.Account(\n            publicKey: "f4c6095213a2f6d09464ed882b12d6024d20f7170c3b8bd5c1b071e4b00ced72" /* TODO: change me */,\n            address: "16XwWkdUqFXFY1tJNf1Q6fGgxQnGYUS6M95wPcrbp2sjjuoC" /* TODO: change me */,\n            network: network\n        )\n    }\n\n    func tezosAccount(network: Tezos.Network) throws -> Tezos.Account {\n        try Tezos.Network(\n            publicKey: "9ae0875d510904b0b15d251d8def1f5f3353e9799841c0ed6d7ac718f04459a0" /* TODO: change me */,\n            address: "tz1SkbBZg15BXPRkYCrSzhY6rq4tKGtpUSWv" /* TODO: change me */,\n            network: network\n        )\n    }\n\n    func run() {\n        createBeaconWallet { result in\n            guard case .success(_) = result else {\n                return\n            }\n\n            self.subscribeToRequests { result in\n                guard case .success(_) = result else {\n                    return\n                }\n\n                self.connectToDApp { result in\n                    guard case .success(_) = result else {\n                        return\n                    }\n                }\n            }\n        }\n    }\n\n    func createBeaconWallet(completion: @escaping (Result<(), Error>) -> ()) {\n        do {\n            // highlight-start\n            Beacon.WalletClient.create(\n                with: .init(\n                    name: "MyApp",\n                    blockchains: [Substrate.factory, Tezos.factory],\n                    connections: [try Transport.P2P.Matrix.connection()]\n                )\n            ) { result in\n            // highlight-end\n                switch result {\n                case let .success(client):\n                    self.beaconWallet = client\n                    completion(.success(()))\n                case let .failure(error):\n                    completion(.failure(error))\n                }\n            }\n        } catch {\n            completion(.failure(error))\n        }\n    }\n\n    func subscribeToRequests(completion: @escaping (Result<(), Error>) -> ()) {\n        // highlight-start\n        beaconWallet.connect { result in\n        // highlight-end\n            switch result {\n            case .success(_):\n                // highlight-start\n                self.beaconWallet.listen(onRequest: self.onSubstrateRequest)\n                self.beaconWallet.listen(onRequest: self.onTezosRequest)\n                // highlight-end\n                completion(.success(()))\n            case let .failure(error):\n                completion(.failure(error))\n            }\n        }\n    }\n\n    func connectToDApp(completion: @escaping (Result<(), Error>) -> ()) {\n        // highlight-start\n        beaconWallet.add([.p2p(dApp)]) { result in\n        // highlight-end\n            switch result {\n            case .success(_):\n                completion(.success(()))\n            case let .failure(error):\n                completion(.failure(error))\n            }\n        }\n    }\n\n    func onSubstrateRequest(_ request: Result<BeaconRequest<Substrate>, Beacon.Error>) {\n        do {\n            let request = try request.get()\n            let response = try response(from: request)\n\n            // highlight-start\n            beaconWallet.respond(with: response) { result in\n            // highlight-end\n                switch result {\n                case .success(_):\n                    print("Response sent")\n                case let .failure(error):\n                    print(error)\n                }\n            }\n        } catch {\n            print(error)\n        }\n    }\n\n    func response(from request: BeaconRequest<Substrate>) throws -> BeaconResponse<Substrate> {\n        // highlight-start\n        switch request {\n        case let .permission(content):\n            let accounts = try content.networks.map { try substrateAccount(network: $0) }\n            return .permission(PermissionSubstrateResponse(from: content, accounts: accounts))\n        case let .blockchain(blockchain):\n            return .error(ErrorBeaconResponse(from: blockchain, errorType: .aborted))\n        }\n        // highlight-end\n    }\n\n    func onTezosRequest(_ request: Result<BeaconRequest<Tezos>, Beacon.Error>) {\n        do {\n            let request = try request.get()\n            let response = try response(from: request)\n\n            // highlight-start\n            beaconWallet.respond(with: response) { result in\n            // highlight-end\n                switch result {\n                case .success(_):\n                    print("Response sent")\n                case let .failure(error):\n                    print(error)\n                }\n            }\n        } catch {\n            print(error)\n        }\n    }\n\n    func response(from request: BeaconRequest<Tezos>) throws -> BeaconResponse<Tezos> {\n        // highlight-start\n        switch request {\n        case let .permission(content):\n            let account = try tezosAccount(network: content.network)\n            return .permission(PermissionTezosResponse(from: content, account: account))\n        case let .blockchain(blockchain):\n            return .error(ErrorBeaconResponse(from: blockchain, errorType: .aborted))\n        }\n        // highlight-end\n    }\n}\n'})})]})}function g(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}}}]);